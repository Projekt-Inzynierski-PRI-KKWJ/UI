<div class="statistics-container">
  <!-- Przycisk do otwierania modala -->
  <div class="help-button-container">
    <button 
      mat-raised-button 
      color="primary" 
      (click)="openHelpModal()"
      class="translate" 
      data-translate="help"
    >
      <mat-icon>help_outline</mat-icon>
      <span class="translate" data-translate="statistics_help">Pomoc - Statystyka</span>
    </button>
  </div>

<div class="chart-header">
  <button class="toggle-btn" (click)="toggleChartType()">
    {{ chartType === 'bar' ? (app.translations['switch_to_line_chart'] || 'Switch to Line Chart') : (app.translations['switch_to_bar_chart'] || 'Switch to Bar Chart') }}
  </button>
</div>

<div class="big-chart">
  <canvas baseChart
          [data]="criteriaSummaryChartData"
          [type]="chartType"
          [options]="chartOptions">
  </canvas>
</div>

<div class="results-lists">

  <div class="passed-list">
    <h3><span class="translate" data-translate="passed_projects">Passed projects</span> ({{ passedProjects.length }})</h3>
    <ul>
      <li *ngFor="let p of passedProjects">{{ p }}</li>
    </ul>
  </div>

  <div class="failed-list">
    <h3><span class="translate" data-translate="failed_projects">Failed projects</span> ({{ failedProjects.length }})</h3>
    <ul>
      <li *ngFor="let p of failedProjects">{{ p }}</li>
    </ul>
  </div>

</div>


<div class="projects-wrapper">
  <div class="project-card"
       *ngFor="let p of projects"
       (click)="openProject(p)">
    {{ p.name }}
  </div>
</div>

<!-- sekcja szczegółów po kliknięciu -->
<div *ngIf="selectedProject" class="details-wrapper">

  <h2><span class="translate" data-translate="project_details">Project Details</span>: {{ selectedProject.name }}</h2>

  <div class="charts-container">
    <div class="chart-box">
      <h3 class="translate" data-translate="first_semester_grade">First Semester Grade</h3>
      <canvas baseChart
              [data]="firstSemesterChartData"
              [options]="chartOptions"
              [type]="chartType">
      </canvas>
    </div>

    <div class="chart-box">
      <h3 class="translate" data-translate="second_semester_grade">Second Semester Grade</h3>
      <canvas baseChart
              [data]="secondSemesterChartData"
              [options]="chartOptions"
              [type]="chartType">
      </canvas>
    </div>
  </div>

  <hr>

  <div class="info-box">
    <h3 class="translate" data-translate="information_about_project">Information about the project</h3>
    <p><b class="translate" data-translate="name">Name:</b> {{ selectedProject.name }}</p>
    <p><b class="translate" data-translate="supervisor">Supervisor:</b> {{ selectedProject.supervisor.name }}</p>
    <p><b class="translate" data-translate="accepted">Accepted:</b> {{ selectedProject.accepted ? (app.translations['yes'] || 'Tak') : (app.translations['no'] || 'Nie') }}</p>
    <p><b class="translate" data-translate="criteria_met">Criteria Met:</b> {{ selectedProject.criteriaMet ? (app.translations['yes'] || 'Tak') : (app.translations['no'] || 'Nie') }}</p>
    <p><b class="translate" data-translate="grading_phase">Grading Phase:</b> {{ selectedProject.evaluationPhase }}</p>
    <p><b class="translate" data-translate="students">Students:</b> {{ selectedProject.students }}</p>
    <p><b class="translate" data-translate="room">Room:</b> {{ selectedProject.classroom || (app.translations['none'] || 'Brak') }}</p>
    <p><b class="translate" data-translate="defence_date">Defence Date:</b> {{ selectedProject.defenseDay || (app.translations['none'] || 'Brak') }}</p>
  </div>

  <h2 class="translate" data-translate="semester_1">SEMESTER 1</h2>

  <div class="charts-row">
    <div class="chart-box small-chart">
      <h3 class="translate" data-translate="expected">Expected</h3>
      <canvas baseChart
              [data]="expectedFirst"
              [options]="chartOptions"
              [type]="chartType">
      </canvas>
    </div>

    <div class="chart-box small-chart">
      <h3 class="translate" data-translate="required">Required</h3>
      <canvas baseChart
              [data]="requiredFirst"
              [options]="chartOptions"
              [type]="chartType">
      </canvas>
    </div>

    <div class="chart-box small-chart">
      <h3 class="translate" data-translate="measureable_indicators">Measureable Indicators</h3>
      <canvas baseChart
              [data]="measurableFirst"
              [options]="chartOptions"
              [type]="chartType">
      </canvas>
    </div>
  </div>

  <h2 class="translate" data-translate="semester_2">SEMESTER 2</h2>

  <div class="charts-row">
    <div class="chart-box small-chart">
      <h3 class="translate" data-translate="expected">Expected</h3>
      <canvas baseChart
              [data]="expectedSecond"
              [options]="chartOptions"
              [type]="chartType">
      </canvas>
    </div>

    <div class="chart-box small-chart">
      <h3 class="translate" data-translate="required">Required</h3>
      <canvas baseChart
              [data]="requiredSecond"
              [options]="chartOptions"
              [type]="chartType">
      </canvas>
    </div>

    <div class="chart-box small-chart">
      <h3 class="translate" data-translate="measureable_indicators">Measureable Indicators</h3>
      <canvas baseChart
              [data]="measurableSecond"
              [options]="chartOptions"
              [type]="chartType">
      </canvas>
    </div>
  </div>

</div>

  <!-- Modal z instrukcjami -->
  <div class="modal-backdrop" *ngIf="showHelpModal" (click)="closeHelpModal()">
    <div class="modal-content" (click)="$event.stopPropagation()">
      <div class="modal-header">
        <h2 class="translate" data-translate="instruction">Instrukcja</h2>
        <button class="close-button" (click)="closeHelpModal()">
          <mat-icon>close</mat-icon>
        </button>
      </div>
      
      <div class="modal-body">
        <div class="tab-content">
          <div class="tab-panel">
            <h3 class="translate" data-translate="statistics_title">Statystyka</h3>
            
            <p class="translate" data-translate="statistics_desc">Widok Statystyka jest dost�pny wy��cznie dla koordynatora. Umo�liwia weryfikacj� wynik�w oraz danych wszystkich grup w odniesieniu do poszczeg�lnych kryteri�w projektu.</p>
            
            <div class="instruction-section">
              <h4 class="translate" data-translate="view_functionalities">Funkcjonalno�ci widoku</h4>
              <ul>
                <li class="translate" data-translate="stats_review_results">przegl�d wynik�w grup wed�ug zdefiniowanych kryteri�w,</li>
                <li class="translate" data-translate="stats_chart_analysis">analiza danych w formie wykres�w.</li>
              </ul>
              <p class="translate" data-translate="stats_change_view">Aby prze��czy� typ wykresu (s�upkowy / ko�owy), kliknij przycisk <strong>Change view</strong>.</p>
            </div>
          </div>
        </div>
      </div>
      
      <div class="modal-footer">
        <button 
          mat-raised-button 
          color="primary" 
          (click)="closeHelpModal()"
          class="translate"
          data-translate="close"
        >
          Zamknij
        </button>
      </div>
    </div>
  </div>
</div>
