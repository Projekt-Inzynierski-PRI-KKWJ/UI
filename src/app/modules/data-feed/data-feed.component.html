<!-- Przycisk do otwierania modala -->
<div class="help-button-container">
  <button 
    mat-raised-button 
    color="accent" 
    (click)="openHelpModal()"
    class="translate" 
    data-translate="help"
  >
    <mat-icon>help_outline</mat-icon>
    <span class="translate" data-translate="csv_json_help">Pomoc CSV/JSON</span>
  </button>
</div>

<!-- Modal z instrukcjami -->
<div class="modal-backdrop" *ngIf="showHelpModal" (click)="closeHelpModal()">
  <div class="modal-content" (click)="$event.stopPropagation()">
    <div class="modal-header">
      <h2>Instrukcja</h2>
      <button class="close-button" (click)="closeHelpModal()">
        <mat-icon>close</mat-icon>
      </button>
    </div>
    
    <div class="modal-body">
      <div class="tabs">
        <button 
          class="tab-button" 
          [class.active]="activeTab === 'students'"
          (click)="activeTab = 'students'"
        >
          Studenci
        </button>
        <button 
          class="tab-button" 
          [class.active]="activeTab === 'supervisors'"
          (click)="activeTab = 'supervisors'"
        >
          Opiekunowie
        </button>
        <button 
          class="tab-button" 
          [class.active]="activeTab === 'criteria'"
          (click)="activeTab = 'criteria'"
        >
          Kryteria
        </button>
      </div>
      
      <div class="tab-content">
        <!-- Instrukcje dla pliku studentów -->
        <div *ngIf="activeTab === 'students'" class="tab-panel">
          <h3>Format pliku studentów</h3>
          
          <div class="format-example">
            <h4>Struktura CSV:</h4>
            <pre><code>nazwisko;imie;nr_albumu,email
Kowalski;Jan;123456;jan.kowalski@example.com
Nazwisko;Imię;654321;imie.nazwisko@example.pl</code></pre>
            <p class="note">Uwaga: Nagłówki kolumn muszą być dokładnie takie jak w przykładzie.</p>
          </div>
        </div>
        
        <!-- Instrukcje dla pliku opiekunów -->
        <div *ngIf="activeTab === 'supervisors'" class="tab-panel">
          <h3>Format pliku opiekunów (Rozszerzenie .csv)</h3>
          
          <div class="format-example">
            <h4>Struktura CSV:</h4>
            <pre><code>"imie";"nazwisko";"email";"nr_albumu";"nr_grupy"
"Jan";"Kowalski";"jan.kowalski@example.com";"123456";"10"
"Imię";"Nazwisko";"imie.nazwisko@example.pl";"654321";"12"</code></pre>
            <p class="note">Uwaga: Nagłówki kolumn muszą być dokładnie takie jak w przykładzie.</p>
          </div>
          
        </div>
        
        <div *ngIf="activeTab === 'criteria'" class="tab-panel">
  <h3>Format pliku kryteriów (Rozszerzenie .json)</h3>
  
  <div class="format-example">
      <div class="format-description">
    <h4>Opis struktury:</h4>
    <ul>
      <li><strong>studyYear</strong>: Rok akademicki i tryb studiów (np. "FULL_TIME#2023")</li>
      <li><strong>minPointsThresholdFirstSemester</strong>: Minimalny próg punktowy dla pierwszego semestru (0.0-1.0)</li>
      <li><strong>minPointsThresholdSecondSemester</strong>: Minimalny próg punktowy dla drugiego semestru (0.0-1.0)</li>
      <li><strong>criteriaSections</strong>: Lista sekcji kryteriów (np. Dokumentacja, Produkty projektu)</li>
      <li><strong>criteriaGroups</strong>: Grupy kryteriów w ramach sekcji</li>
      <li><strong>criteria</strong>: Szczegółowe kryteria oceny z punktacją i opisami</li>
      <li><strong>isDisqualifying</strong>: Czy niespełnienie kryterium dyskwalifikuje projekt</li>
      <li><strong>category</strong>: Kategoria spełnienia kryterium (CRITERION_NOT_MET, UNSUCCESSFUL_ATTEMPT_TO_MEET_THE_CRITERION, CRITERION_MET_WITH_RESERVATIONS, CRITERION_MET)</li>
    </ul>
  </div>
    <h4>Struktura JSON:</h4>
    <pre><code>{{"{"}}
  "studyYear": "FULL_TIME#2023",
  "minPointsThresholdFirstSemester": 0.83,
  "minPointsThresholdSecondSemester": 0.75,
  "criteriaSections": [
    {{"{"}}
      "idFirstSemester": 1,
      "idSecondSemester": 2,
      "name": "Dokumentacja",
      "isDefenseSection": false,
      "criteriaSectionGradeWeightFirstSemester": 0.2,
      "criteriaSectionGradeWeightSecondSemester": 0.1,
      "criteriaGroups": [
        {{"{"}}
          "idFirstSemester": null,
          "idSecondSemester": 5,
          "name": "Dokumentacja dla klienta/grupy docelowej/użytkownika",
          "gradeWeightFirstSemester": 0.0,
          "gradeWeightSecondSemester": 0.03,
          "criteria": [
            {{"{"}}
              "id": 13,
              "category": "CRITERION_NOT_MET",
              "points": 0,
              "description": "brak dokumentacji",
              "isDisqualifying": false
            {{"}"}},
            {{"{"}}
              "id": 14,
              "category": "UNSUCCESSFUL_ATTEMPT_TO_MEET_THE_CRITERION",
              "points": 1,
              "description": "trywialna dokumentacja nie wnosząca dodatkowej wiedzy o systemie",
              "isDisqualifying": false
            {{"}"}},
            {{"{"}}
              "id": 15,
              "category": "CRITERION_MET_WITH_RESERVATIONS",
              "points": 3,
              "description": "brak dokumentacji, jeśli takie było wymaganie projektowe/dokumentacja tego typu jest zbędna (wymaga uzasadnienia); poprawna dokumentacja nieprzedstawiona klientowi/grupie docelowej (np. plik PDF na stronie projektu)",
              "isDisqualifying": false
            {{"}"}},
            {{"{"}}
              "id": 16,
              "category": "CRITERION_MET",
              "points": 4,
              "description": "poprawnie zredagowana i użyteczna dokumentacja przekazana klientowi/grupie docelowej systemu; dokumentacja w postaci samouczka (np. w grach komputerowych) lub strony w sklepie Play dla aplikacji mobilnych",
              "isDisqualifying": false
            {{"}"}}
          ]
        {{"}"}},
        {{"{"}}
          "idFirstSemester": null,
          "idSecondSemester": 6,
          "name": "Dokumentacja deweloperska",
          "gradeWeightFirstSemester": 0.0,
          "gradeWeightSecondSemester": 0.03,
          "criteria": [
            {{"{"}}
              "id": 17,
              "category": "CRITERION_NOT_MET",
              "points": 0,
              "description": "brak dokumentacji",
              "isDisqualifying": false
            {{"}"}},
            {{"{"}}
              "id": 18,
              "category": "UNSUCCESSFUL_ATTEMPT_TO_MEET_THE_CRITERION",
              "points": 1,
              "description": "trywialna dokumentacja nie wnosząca dodatkowej wiedzy o systemie; dokumentacja dotyczy tylko jednej warstwy systemu (np. frontend)",
              "isDisqualifying": false
            {{"}"}},
            {{"{"}}
              "id": 19,
              "category": "CRITERION_MET_WITH_RESERVATIONS",
              "points": 3,
              "description": "dokumentacja użyteczna; obejmuje wszystkie warstwy jednak niekompletna (nie wyjaśnia wszystkich zasobów niezbędnych do rozpoczęcia pracy z projektem, jednak osoba z doświadczeniem w danej technologii jest wstanie to zrobić)",
              "isDisqualifying": false
            {{"}"}},
            {{"{"}}
              "id": 20,
              "category": "CRITERION_MET",
              "points": 4,
              "description": "kompletna dokumentacja deweloperska określająca wszystkie zasoby niezbędne do rozpoczęcia pracy nad projektem. Dokumentacja powinna być wystarczająca do przekazania projektu następnemu zespołowi w celu jego kontynuacji",
              "isDisqualifying": false
            {{"}"}}
          ]
        {{"}"}},
        {{"{"}}
          "idFirstSemester": 2,
          "idSecondSemester": null,
          "name": "Dokument wymagań projektowych I*",
          "gradeWeightFirstSemester": 0.08,
          "gradeWeightSecondSemester": 0.0,
          "criteria": [
            {{"{"}}
              "id": 5,
              "category": "CRITERION_NOT_MET",
              "points": 0,
              "description": "brak dokumentu, dokument niezgodny z szablonem; brak wymagań funkcjonalnych; brak kryteriów akceptacji projektu na oba semestry",
              "isDisqualifying": true
            {{"}"}},
            {{"{"}}
              "id": 6,
              "category": "UNSUCCESSFUL_ATTEMPT_TO_MEET_THE_CRITERION",
              "points": 1,
              "description": "brak weryfikowalnych kryteriów akceptacji projektu na jeden z semestrów; dokument nie zawiera wszystkich wymaganych informacji; przedstawione informacje są błędne/nieprawdziwe; dokument nie odzwierciedla aktualnego stanu projektu; zadeklarowany zakres projektu jest zbyt mały; kryteria akceptacji są nie weryfikowalne; wskażniki wdrożeniowe są niemierzalne",
              "isDisqualifying": true
            {{"}"}},
            {{"{"}}
              "id": 7,
              "category": "CRITERION_MET_WITH_RESERVATIONS",
              "points": 3,
              "description": "dokument zaakceptowany przez prowadzącego; jeden aspekt dokumentu nie jest wystarczająco opisany; jedno kryterium akceptacji nie jest weryfikowalne; dokument w większości odzwierciedla aktualny stan projektu; zakres prac przewidziany na poszczególne semestry jest adekwatny",
              "isDisqualifying": false
            {{"}"}},
            {{"{"}}
              "id": 8,
              "category": "CRITERION_MET",
              "points": 4,
              "description": "dokument poprawny; odzwierciedla aktualny stan projektu i pozwala na obiektywną ocene jego realizacji",
              "isDisqualifying": false
            {{"}"}}
          ]
        {{"}"}}
      ]
    {{"}"}},
    {{"{"}}
      "idFirstSemester": 5,
      "idSecondSemester": 6,
      "name": "Produkty projektu",
      "isDefenseSection": false,
      "criteriaSectionGradeWeightFirstSemester": 0.33,
      "criteriaSectionGradeWeightSecondSemester": 0.35,
      "criteriaGroups": [
        {{"{"}}
          "idFirstSemester": 26,
          "idSecondSemester": null,
          "name": "Czy przygotowano prototyp projektu zgodnie ze sztuką? *",
          "gradeWeightFirstSemester": 0.04,
          "gradeWeightSecondSemester": 0.0,
          "criteria": [
            {{"{"}}
              "id": 93,
              "category": "CRITERION_NOT_MET",
              "points": 0,
              "description": "brak prototypu; prototyp nieprzydatny, niezgodny ze specyfiką projektu, nieodpowiadający zaprezentowanemu projektowi",
              "isDisqualifying": true
            {{"}"}},
            {{"{"}}
              "id": 94,
              "category": "UNSUCCESSFUL_ATTEMPT_TO_MEET_THE_CRITERION",
              "points": 1,
              "description": "prototyp stworzony na własne potrzeby; częściowo wykorzystany przy tworzeniu docelowego interfejsu systemu",
              "isDisqualifying": false
            {{"}"}},
            {{"{"}}
              "id": 95,
              "category": "CRITERION_MET_WITH_RESERVATIONS",
              "points": 3,
              "description": "prototyp adekwatny do projektu, skonsultowany z klientem/grupą docelową i wykorzystany przy tworzeniu docelowego interfejsu systemu",
              "isDisqualifying": false
            {{"}"}},
            {{"{"}}
              "id": 96,
              "category": "CRITERION_MET",
              "points": 4,
              "description": "prototyp iteracyjnie budowny i konsultowany z klientem/grupą docelową (przynajmniej 3 wersje); prototyp pełni istotną rolę w projektowaniu nowych funkcjonalności systemu",
              "isDisqualifying": false
            {{"}"}}
          ]
        {{"}"}}
      ]
    {{"}"}}
  ]
{{"}"}}</code></pre>
  </div>


</div>
      </div>
    </div>
    
    <div class="modal-footer">
      <button 
        mat-raised-button 
        color="primary" 
        (click)="closeHelpModal()"
        class="translate"
        data-translate="close"
      >
        Zamknij
      </button>
    </div>
  </div>
</div>

<h2 class="translate" data-translate="import">Import</h2>
<div class="file-inputs">
  
  <input type="file" class="file-input" (change)="uploadStudents($event)" #studentsFileUpload>
  <div class="file-upload">
    <button mat-mini-fab color="primary" class="upload-btn" (click)="studentsFileUpload.click()">
      <mat-icon>attach_file</mat-icon>
    </button>
    <ng-container *ngIf="studentsFileName; else translateStudents">
      {{ studentsFileName }}
    </ng-container>
    <ng-template #translateStudents>
      <span class="translate" data-translate="students">Students</span>
    </ng-template>
  </div>
 
  <input type="file" class="file-input" (change)="uploadSupervisors($event)" #supervisorsFileUpload>
  <div class="file-upload">
    <button mat-mini-fab color="primary" class="upload-btn" (click)="supervisorsFileUpload.click()">
      <mat-icon>attach_file</mat-icon>
    </button>
    <ng-container *ngIf="supervisorsFileName; else translateSupervisors">
      {{ supervisorsFileName }}
    </ng-container>
    <ng-template #translateSupervisors>
      <span class="translate" data-translate="supervisors">Supervisors</span>
    </ng-template>
  </div>  

  <input type="file" class="file-input" (change)="uploadCriteria($event)" #criteriaFileUpload>
  <div class="file-upload">
    <button mat-mini-fab color="primary" class="upload-btn" (click)="criteriaFileUpload.click()">
      <mat-icon>attach_file</mat-icon>
    </button>
    <ng-container *ngIf="criteriaFileName; else translateCriteria">
      {{ criteriaFileName }}
    </ng-container>
    <ng-template #translateCriteria>
      <span class="translate" data-translate="criteria">Criteria</span>
    </ng-template>
  </div>  

  <button (click)="uploadFiles()" mat-raised-button color="primary" class="translate" data-translate="submit">
    Submit
  </button>
</div>

<h2 class="translate" data-translate="export">Export</h2>
<div class="file-inputs">
  <button (click)="exportStudents()" mat-raised-button color="primary" class="translate" data-translate="students">Students</button>
  <button (click)="exportCriteria()" mat-raised-button color="primary" class="translate" data-translate="criteria">Criteria</button>
  <button (click)="exportGrades()" mat-raised-button color="primary" class="translate" data-translate="grades">Grades</button>
</div>

<h2 class="translate" data-translate="study_year_data_export">Study Year Data Export</h2>
<div class="study-year-export">
  <div class="section-header">
    <p class="translate" data-translate="export_complete_study_year">Export complete study year data including projects, students, grades, links, and metadata</p>
  </div>
  
  <div *ngIf="availableStudyYears.length === 0" class="no-data">
    <mat-icon>info</mat-icon>
    <span class="translate" data-translate="no_study_years_available_for_export">No study years available for export</span>
  </div>
  
  <div *ngIf="availableStudyYears.length > 0" class="study-years-table">
    <table mat-table [dataSource]="availableStudyYears" class="export-table">
      <ng-container matColumnDef="studyYear">
        <th mat-header-cell *matHeaderCellDef class="translate" data-translate="study_year">Study Year</th>
        <td mat-cell *matCellDef="let studyYear" class="study-year-cell">
          <div class="study-year-info">
            <mat-icon>school</mat-icon>
            <span class="study-year-name">{{ studyYear.replace('-', '#') }}</span>
          </div>
        </td>
      </ng-container>        <ng-container matColumnDef="actions">
          <th mat-header-cell *matHeaderCellDef class="actions-header translate" data-translate="actions">Actions</th>
          <td mat-cell *matCellDef="let studyYear" class="actions-cell">
          <div class="action-buttons">
            <button 
              mat-stroked-button 
              color="primary" 
              (click)="exportStudyYearDataAsPdf(studyYear)"
              class="export-btn"
            >
              <mat-icon>picture_as_pdf</mat-icon>
              <span>PDF</span>
            </button>
          </div>
        </td>
      </ng-container>

      <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
      <tr mat-row *matRowDef="let row; columns: displayedColumns;"></tr>
    </table>
  </div>
</div>

   
<h2 class="translate" data-translate="critical_operations" style="margin-top: 30px;">Critical Operations</h2>
<div class="reset-section">
  <button 
    mat-raised-button 
    color="warn" 
    class="reset-btn" 
    (click)="openResetDialog()">
    <mat-icon>warning</mat-icon>
    <span class="translate" data-translate="reset_database">
      Reset Database
    </span> 
  </button>
</div>
