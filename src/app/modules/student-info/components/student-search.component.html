<div class="student-search-container">
  <!-- Help Button -->
  <div class="help-button-container">
    <button mat-raised-button color="primary" (click)="openHelpModal()">
      <mat-icon>help_outline</mat-icon>
      <span class="translate" data-translate="student_info_help">Pomoc</span>
    </button>
  </div>

  <h1 class="translate" data-translate="student_information">Student Information</h1>

  <!-- Search and Filters -->
  <div class="filters-section">
    <mat-form-field class="search-field" appearance="outline">
      <mat-label class="translate" data-translate="search_students">Search students</mat-label>
      <input matInput [formControl]="searchControl" placeholder="Name, index number, or email...">
      <mat-icon matPrefix>search</mat-icon>
    </mat-form-field>

    <mat-form-field appearance="outline">
      <mat-label class="translate" data-translate="study_year">Study year</mat-label>
      <mat-select [formControl]="studyYearFilter">
        <mat-option value="" class="translate" data-translate="all">All</mat-option>
        <mat-option *ngFor="let year of studyYears" [value]="year">{{ year }}</mat-option>
      </mat-select>
    </mat-form-field>

    <mat-form-field appearance="outline">
      <mat-label class="translate" data-translate="has_project">Has project</mat-label>
      <mat-select [formControl]="hasProjectFilter">
        <mat-option [value]="null" class="translate" data-translate="all">All</mat-option>
        <mat-option [value]="true" class="translate" data-translate="yes">Yes</mat-option>
        <mat-option [value]="false" class="translate" data-translate="no">No</mat-option>
      </mat-select>
    </mat-form-field>

    <button mat-raised-button (click)="clearFilters()" class="translate" data-translate="clear_filters">Clear Filters</button>
  </div>

  <!-- Results Summary -->
  <div class="results-summary">
    <p><span class="translate" data-translate="found_students">Found</span> {{ filteredStudents?.length || 0 }} <span class="translate" data-translate="students_count">student(s)</span></p>
  </div>

  <!-- Students List -->
  <div class="students-list" *ngIf="!selectedStudent">
    <mat-card *ngFor="let student of filteredStudents" class="student-card" (click)="selectStudent(student)">
      <mat-card-header>
        <mat-card-title>{{ getFullName(student) }}</mat-card-title>
        <mat-card-subtitle>{{ student.indexNumber }}</mat-card-subtitle>
      </mat-card-header>
      <mat-card-content>
        <div class="student-card-info">
          <div class="info-row">
            <mat-icon>email</mat-icon>
            <span>{{ student.email }}</span>
          </div>
          <div class="info-row" *ngIf="student.confirmedProjectName || (student.assignedProjectIds && student.assignedProjectIds.length > 0)">
            <mat-icon>assignment</mat-icon>
            <a *ngIf="student.confirmedProjectId" 
               [routerLink]="['/projects/details', student.confirmedProjectId]"
               (click)="$event.stopPropagation()"
               class="project-link">
              {{ student.confirmedProjectName }}
            </a>
            <span *ngIf="!student.confirmedProjectId && student.assignedProjectIds && student.assignedProjectIds.length > 0">
              <span class="translate" data-translate="assigned_to_projects">Assigned to</span> {{ student.assignedProjectIds.length }} <span class="translate" data-translate="projects_count">project(s)</span>
            </span>
          </div>
          <div class="info-row" *ngIf="student.projectSupervisor">
            <mat-icon>person</mat-icon>
            <span>{{ student.projectSupervisor }}</span>
          </div>
          <div class="info-row" *ngIf="student.actualYear">
            <mat-icon>school</mat-icon>
            <span>{{ student.actualYear }}</span>
          </div>
          <div class="info-row">
            <mat-icon>{{ student.accepted ? 'check_circle' : 'cancel' }}</mat-icon>
            <span class="translate" [attr.data-translate]="student.accepted ? 'accepted' : 'not_accepted'">{{ student.accepted ? 'Accepted' : 'Not Accepted' }}</span>
          </div>
          <div class="info-row" *ngIf="student.defenseDate">
            <mat-icon>event</mat-icon>
            <span>{{ student.defenseDate }} at {{ student.defenseTime }}</span>
          </div>
        </div>
      </mat-card-content>
    </mat-card>
  </div>

  <!-- Student Details View -->
  <div class="student-details" *ngIf="selectedStudent">
    <div class="detail-header">
      <button mat-icon-button (click)="clearSelection()" class="back-button">
        <mat-icon>arrow_back</mat-icon>
      </button>
      <button mat-raised-button color="accent" (click)="exportStudentAsPDF()" class="export-button">
        <mat-icon>picture_as_pdf</mat-icon>
        <span class="translate" data-translate="export_as_pdf">Export as PDF</span>
      </button>
    </div>

    <mat-card class="details-card">
      <mat-card-header>
        <mat-card-title>{{ getFullName(selectedStudent) }}</mat-card-title>
        <mat-card-subtitle>{{ selectedStudent.indexNumber }}</mat-card-subtitle>
      </mat-card-header>
      
      <mat-card-content>
        <div class="details-grid">
          <!-- Personal Information -->
          <div class="details-section">
            <h3><mat-icon>person</mat-icon> <span class="translate" data-translate="personal_information">Personal Information</span></h3>
            <div class="detail-item">
              <span class="label translate" data-translate="full_name">Full Name:</span>
              <span class="value">{{ selectedStudent.name }}</span>
            </div>
            <div class="detail-item">
              <span class="label translate" data-translate="index_number">Index Number:</span>
              <span class="value">{{ selectedStudent.indexNumber }}</span>
            </div>
            <div class="detail-item">
              <span class="label translate" data-translate="email">Email:</span>
              <span class="value">{{ selectedStudent.email }}</span>
            </div>
            <div class="detail-item">
              <span class="label translate" data-translate="role">Role:</span>
              <span class="value">{{ selectedStudent.role }}</span>
            </div>
            <div class="detail-item" *ngIf="selectedStudent.studyYears && selectedStudent.studyYears.length > 0">
              <span class="label translate" data-translate="study_years">Study Years:</span>
              <span class="value">{{ selectedStudent.studyYears.join(', ') }}</span>
            </div>
          </div>

          <!-- Project Information -->
          <div class="details-section">
            <h3><mat-icon>assignment</mat-icon> <span class="translate" data-translate="project_information">Project Information</span></h3>
            <div class="detail-item" *ngIf="selectedStudent.confirmedProjectId">
              <span class="label translate" data-translate="confirmed_project">Confirmed Project:</span>
              <span class="value">
                <a [routerLink]="['/projects/details', selectedStudent.confirmedProjectId]" class="project-link">
                  {{ selectedStudent.confirmedProjectName }} (ID: {{ selectedStudent.confirmedProjectId }})
                </a>
              </span>
            </div>
            <div class="detail-item" *ngIf="selectedStudent.assignedProjectIds && selectedStudent.assignedProjectIds.length > 0">
              <span class="label"><span class="translate" data-translate="assigned_projects">Assigned Projects</span> ({{ selectedStudent.assignedProjectIds.length }}):</span>
              <span class="value">
                <span *ngFor="let projectId of selectedStudent.assignedProjectIds; let i = index; let last = last">
                  <a [routerLink]="['/projects/details', projectId]" class="project-link">
                    {{ selectedStudent.assignedProjectNames && selectedStudent.assignedProjectNames[i] ? selectedStudent.assignedProjectNames[i] : (app.translations['project'] || 'Project') + ' ' + projectId }}
                  </a><span *ngIf="!last">, </span>
                </span>
              </span>
            </div>

            <div class="detail-item" *ngIf="selectedStudent.projectSupervisor">
              <span class="label translate" data-translate="supervisor">Supervisor:</span>
              <span class="value">{{ selectedStudent.projectSupervisor }}</span>
            </div>
            <div class="detail-item" *ngIf="selectedStudent.defenseDate">
              <span class="label translate" data-translate="defense_date">Defense Date:</span>
              <span class="value">{{ selectedStudent.defenseDate }}</span>
            </div>
            <div class="detail-item" *ngIf="selectedStudent.defenseTime">
              <span class="label translate" data-translate="defense_time">Defense Time:</span>
              <span class="value">{{ selectedStudent.defenseTime }}</span>
            </div>
          </div>

          <!-- Grades -->
          <div class="details-section">
            <h3><mat-icon>grade</mat-icon> <span class="translate" data-translate="grades">Grades</span></h3>
            <div class="detail-item">
              <span class="label translate" data-translate="first_semester_grade">First Semester Grade:</span>
              <span class="value grade">{{ selectedStudent.firstSemesterGrade || 'N/A' }}</span>
            </div>
            <div class="detail-item">
              <span class="label translate" data-translate="second_semester_grade">Second Semester Grade:</span>
              <span class="value grade">{{ selectedStudent.secondSemesterGrade || 'N/A' }}</span>
            </div>
            <div class="detail-item">
              <span class="label translate" data-translate="final_grade">Final Grade:</span>
              <span class="value grade final">{{ selectedStudent.finalGrade || 'N/A' }}</span>
            </div>
          </div>
        </div>
      </mat-card-content>
    </mat-card>
  </div>

  <!-- Empty State -->
  <div class="empty-state" *ngIf="filteredStudents?.length === 0 && !selectedStudent">
    <mat-icon>search_off</mat-icon>
    <h2 class="translate" data-translate="no_students_found">No students found</h2>
    <p class="translate" data-translate="adjust_search_filters">Try adjusting your search filters</p>
  </div>
</div>


  <!-- Modal z instrukcjami -->
  <div class="modal-backdrop" *ngIf="showHelpModal" (click)="closeHelpModal()">
    <div class="modal-content" (click)="$event.stopPropagation()">
      <div class="modal-header">
        <h2 class="translate" data-translate="instruction">Instrukcja</h2>
        <button class="close-button" (click)="closeHelpModal()">
          <mat-icon>close</mat-icon>
        </button>
      </div>
      
      <div class="modal-body">
        <div class="tab-content">
          <div class="tab-panel">
            <h3 class="translate" data-translate="student_info_title">Informacje o studentach</h3>
            
            <p class="translate" data-translate="student_info_desc">Widok Informacje o studentach jest dostêpny wy³¹cznie dla koordynatora. Umo¿liwia weryfikacjê danych wszystkich studentów oraz pobranie ich informacji w formacie PDF.</p>
            
            <div class="instruction-section">
              <h4 class="translate" data-translate="view_functionalities">Funkcjonalnoœci widoku</h4>
              <ul>
                <li class="translate" data-translate="student_info_review">przegl¹d danych wszystkich studentów,</li>
                <li class="translate" data-translate="student_info_download_pdf">pobieranie szczegó³owych informacji o studentach w pliku PDF.</li>
              </ul>
            </div>
          </div>
        </div>
      </div>
      
      <div class="modal-footer">
        <button 
          mat-raised-button 
          color="primary" 
          (click)="closeHelpModal()"
          class="translate"
          data-translate="close"
        >
          Zamknij
        </button>
      </div>
    </div>
  </div>
