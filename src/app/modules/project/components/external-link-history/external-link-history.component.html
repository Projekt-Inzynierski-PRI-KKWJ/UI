<div class="history-container">
  <div class="history-header">
    <mat-icon>history</mat-icon>
    <h4>
      <span class="translate" data-translate="change_history_for">Change History for</span> 
      "{{ externalLinkName }}"
    </h4>
  </div>

  <div *ngIf="loading" class="loading-container">
    <mat-spinner diameter="30"></mat-spinner>
    <span class="translate" data-translate="loading_history">Loading history...</span>
  </div>

  <div *ngIf="!loading && historyDataSource.data.length === 0" class="no-history">
    <mat-icon>info</mat-icon>
    <span class="translate" data-translate="no_history_available">No change history available</span>
  </div>

  <div *ngIf="!loading && historyDataSource.data.length > 0" class="history-table-container">
    <table mat-table [dataSource]="historyDataSource" class="history-table">
      
      <ng-container matColumnDef="changeDate">
        <th mat-header-cell *matHeaderCellDef class="translate" data-translate="date_and_time">Date & Time</th>
        <td mat-cell *matCellDef="let history">
          <div class="date-cell">
            <mat-icon class="date-icon">schedule</mat-icon>
            <span>{{ formatDateTime(history.changeDate) }}</span>
          </div>
        </td>
      </ng-container>

      <ng-container matColumnDef="changeType">
        <th mat-header-cell *matHeaderCellDef class="translate" data-translate="type">Type</th>
        <td mat-cell *matCellDef="let history">
          <div class="change-type-cell">
            <mat-icon [color]="getChangeTypeColor(history.changeType)">
              {{ getChangeTypeIcon(history.changeType) }}
            </mat-icon>
            <span>{{ app.translations[history.changeType.toLowerCase()] || formatChangeType(history.changeType) }}</span>
          </div>
        </td>
      </ng-container>

      <ng-container matColumnDef="changedBy">
        <th mat-header-cell *matHeaderCellDef class="translate" data-translate="changed_by">Changed by</th>
        <td mat-cell *matCellDef="let history">
          <div class="user-cell">
            <mat-icon class="user-icon">person</mat-icon>
            <div class="user-info">
              <span class="user-name">{{ history.changedByUserName }}</span>
              <span class="user-index">({{ history.changedByUserIndexNumber }})</span>
            </div>
          </div>
        </td>
      </ng-container>

      <ng-container matColumnDef="description">
        <th mat-header-cell *matHeaderCellDef class="translate" data-translate="description">Description</th>
        <td mat-cell *matCellDef="let history">
          <div class="description-cell">
            <span>{{ history.changeDescription }}</span>
          </div>
        </td>
      </ng-container>

      <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
      <tr mat-row *matRowDef="let row; columns: displayedColumns;" class="history-row"></tr>
    </table>
  </div>
</div>